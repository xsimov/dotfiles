source ~/dotfiles/vim/plugins.vim
source ~/dotfiles/vim/prettier.vim

autocmd ColorScheme * highlight TrailingSpaces ctermbg=red guibg=#592929 ctermfg=white

set number
set nornu
set expandtab
set shiftwidth=2
set softtabstop=2
set tabstop=4
set mouse=a
set backspace=2
set splitright
set gcr=a:blinkon0
set guifont=Monaco:h15
colorscheme angr

set ignorecase
set smartcase

set directory^=$HOME/.vim/tmp//

set wildignore+=*/tmp/*,*.so,*.swp,*.zip

let g:user_emmet_mode='a'

let test#ruby#rspec#executable = 'bin/rspec'
let test#ruby#minitest#executable = 'bin/rake test'
let g:test#preserve_screen = 1
let test#strategy = {
      \ "suite": "tslime",
      \ "file": "tslime",
      \ "nearest": "tslime",
      \ "last": "tslime",
      \ }

let g:markdown_fenced_languages = ['html', 'python', 'bash=sh', 'ruby', 'go']

let g:go_fmt_command = 'goimports'

map <C-p> :LeaderfFile<CR>

let g:go_highlight_extra_types = 1
let g:go_highlight_functions = 1
let g:go_highlight_methods = 1
let g:go_highlight_structs = 1
let g:go_highlight_types = 1
let g:go_highlight_operators = 1
let g:go_highlight_function_arguments = 1
let g:go_highlight_build_constraints = 1
let g:go_highlight_function_calls = 1

let g:go_highlight_variable_declarations = 1
let g:go_highlight_variable_assignments = 1

let g:prettier#exec_cmd_path = "client/node_modules/prettier/bin-prettier.js"

map <Leader>t :w<CR>:TestFile<CR>
map <Leader>s :w<CR>:TestNearest<CR>
map <Leader>l :w<CR>:TestLast<CR>
map <Leader>a :w<CR>:TestSuite<CR>

map <Leader>q :vsp .<CR>
map <Leader>f :echo @%<CR>
map <Leader>* :G <cword><CR>
map <Leader>S :Gstatus<CR>

nmap <leader>w :cw<CR>
nmap <leader>] :cn<CR>
nmap <leader>[ :cp<CR>
nmap <leader>- :sp<CR><C-p>
nmap <leader>\ :vsp<CR><C-p>
nmap <leader>D Orequire 'pry';binding.pry<Esc>

imap <leader>D require 'pry';binding.pry<Esc>
imap <S-Tab> <C-p>
imap <Tab> <C-n>

nnoremap <C-J> <C-W><C-J>
nnoremap <C-K> <C-W><C-K>
nnoremap <C-L> <C-W><C-L>
nnoremap <C-H> <C-W><C-H>

autocmd!
au CursorHoldI <buffer> stopinsert
au FocusLost,BufLeave * wa
autocmd BufNewFile,BufReadPost *.md set filetype=markdown
syntax on

highlight OverLength ctermbg=red ctermfg=white guibg=#592929
highlight HLTrailingSpaces ctermbg=red ctermfg=white guibg=#592929

match HLTrailingSpaces /\s\+$/

function ForceHighlightingTrailingSpaces()
  match HLTrailingSpaces /\s\+$/
endfunction

function ShowOver80Chars()
  match OverLength /\%81v.\+/
endfunction

function HideOver80Chars()
  match OverLength //
endfunction

func GitGrep(...)
  let save = &grepprg
  set grepprg=git\ grep\ -n\ $*
  let s = 'grep'
  for i in a:000
    let s = s . ' ' . i
  endfor
  exe s
  let &grepprg = save
endfun
command -nargs=? G call GitGrep(<f-args>)

" Triger `autoread` when files changes on disk
" https://unix.stackexchange.com/questions/149209/refresh-changed-content-of-file-opened-in-vim/383044#383044
" https://vi.stackexchange.com/questions/13692/prevent-focusgained-autocmd-running-in-command-line-editing-mode
autocmd FocusGained,BufEnter,CursorHold,CursorHoldI * if mode() != 'c' | checktime | endif
" Notification after file change
" https://vi.stackexchange.com/questions/13091/autocmd-event-for-autoread
autocmd FileChangedShellPost *
  \ echohl WarningMsg | echo "File changed on disk. Buffer reloaded." | echohl None
